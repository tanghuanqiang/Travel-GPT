#!/bin/bash

# TravelPlanGPT å¯åŠ¨è„šæœ¬

echo "ğŸš€ å¯åŠ¨ TravelPlanGPT..."

# æ£€æŸ¥æ˜¯å¦åœ¨é¡¹ç›®æ ¹ç›®å½•
if [ ! -d "frontend" ] || [ ! -d "backend" ]; then
    echo "âŒ è¯·åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œæ­¤è„šæœ¬"
    exit 1
fi

# å¯åŠ¨åç«¯
echo "ğŸ“¡ å¯åŠ¨åç«¯æœåŠ¡..."
cd backend
if [ ! -d "venv" ]; then
    echo "åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ..."
    python -m venv venv
fi

source venv/bin/activate
pip install -r requirements.txt -q

# æ£€æŸ¥ .env æ–‡ä»¶
if [ ! -f ".env" ]; then
    echo "âš ï¸  æœªæ‰¾åˆ° .env æ–‡ä»¶ï¼Œä» .env.example å¤åˆ¶..."
    cp .env.example .env
    echo "è¯·ç¼–è¾‘ backend/.env æ–‡ä»¶ï¼Œå¡«å…¥ä½ çš„ API Keys"
fi

python main.py &
BACKEND_PID=$!
cd ..

# å¯åŠ¨å‰ç«¯
echo "ğŸ¨ å¯åŠ¨å‰ç«¯æœåŠ¡..."
cd frontend

if [ ! -d "node_modules" ]; then
    echo "å®‰è£…ä¾èµ–..."
    npm install
fi

npm run dev &
FRONTEND_PID=$!
cd ..

echo ""
echo "âœ… å¯åŠ¨æˆåŠŸï¼"
echo "å‰ç«¯: http://localhost:3000"
echo "åç«¯: http://localhost:8000"
echo "APIæ–‡æ¡£: http://localhost:8000/docs"
echo ""
echo "æŒ‰ Ctrl+C åœæ­¢æœåŠ¡"

# ç­‰å¾…ç”¨æˆ·ä¸­æ–­
wait
